from scraper.Scraper import Scraper
from utils import publish_or_update, publish_logo, show_jobs, create_job
from getCounty import GetCounty

_counties = GetCounty()
url = "https://pentest-tools.com/jobs"
company = "PENTESTTOOLS"

scraper = Scraper()
scraper.get_from_url(url)

title_containers = scraper.find_all(
    "span", class_="flex items-start justify-between space-x-3 sm:items-center"
)
job_titles = [container.find("span").text for container in title_containers]

location_containers = scraper.find_all("dd", {"data-content-block-body": True})
locations = [
    (x.split(",")[0].strip(), x.split(",")[1].strip())
    for x in [location.text for location in location_containers]
]

link_containers = scraper.find_all(
    "a",
    class_="inline-flex cursor-pointer touch-none select-none items-center justify-center whitespace-nowrap border text-center font-semibold tracking-tight transition focus:outline-none disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-75 rounded-md px-4 py-2 text-sm text-dark-blue-500 hover:text-dark-blue-400 focus:bg-light-blue-200 border-transparent focus:bg-opacity-40 relative -mr-px w-0 flex-1 focus:z-10 relative -mr-px w-0 flex-1 focus:z-10",
)
job_links = [link["href"] for link in link_containers]
final_jobs = []

base_url = "https://pentest-tools.com"

for title, location, link in zip(job_titles, locations, job_links):
    city, country = location
    county = _counties.get_county(city)
    full_link = base_url if link.startswith("/jobs") else url

    final_jobs.append(
        create_job(
            job_title=title,
            company=company,
            country=location[1],
            city=city,
            county=county,
            job_link=full_link + link,
        )
    )

publish_or_update(final_jobs)
publish_logo(
    company, "https://pentest-tools.com/images/logos/pentesttools-logomark.svg"
)
show_jobs(final_jobs)
